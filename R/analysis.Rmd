---
title: "Untitled"
author: "Michael Wu"
date: "2023-04-12"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MplusAutomation)
library(tidyverse)
#devtools::install_github("nyuglobalties/mrautomatr")
library(mrautomatr)
```

# WAVE 1
## Parents 

### DASS (Stress) Time 1

```{r}
prop.table(table(dat_dass_b$female))
prop.table(table(dat_dass_b$age_w))
```

```{r}
# EFA
runModels(
  "Mplus/wave1/dass_parent/dass1_parent_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/dass_parent/dass1_parent_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_cfa1.inp", # final
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave1/dass_parent/dass1_parent_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave1/dass_parent/dass1_parent_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave1/dass_parent/dass1_parent_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_parent/dass1_parent_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1",
               output_file = "Report_dass_parent.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave1/dass_parent/input_dass_parent.xlsx"),
                 set_title = "Measurement Report - DASS Baseline (Parent)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = FALSE)
                 )

```

## Students

### Grit Time 1 and 2
```{r}
# EFA
runModels(
  "Mplus/wave1/grit_student/grit1_student_efa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/grit_student/grit1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_cfa2.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_cfa.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave1/grit_student/grit1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_tx_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave1/grit_student/grit1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_gender_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave1/grit_student/grit1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit1_student_age_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit2_student_age_inv_scalar.inp",
  recursive=TRUE)

# Longitudinal invariance
runModels(
  "Mplus/wave1/grit_student/grit12_student_lg_inv_baseline.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit12_student_lg_inv_loading.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit12_student_lg_inv_threshold.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/grit_student/grit12_student_lg_inv_unique.inp",
  recursive=TRUE)
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1",
               output_file = "Report_grit_student.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave1/grit_student/input_grit_student.xlsx"),
                 set_title = "Measurement Report - Grit (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

```

### Sleep Time 1
```{r}
# EFA
runModels(
  "Mplus/wave1/sleep_student/sleep1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/sleep_student/sleep1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_cfa1.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave1/sleep_student/sleep1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave1/sleep_student/sleep1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave1/sleep_student/sleep1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/sleep_student/sleep1_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1",
               output_file = "Report_sleep_student.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave1/sleep_student/input_sleep_student.xlsx"),
                 set_title = "Measurement Report - Insomnia Severity Index - Baseline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = FALSE)
                 )

```

### DASS (Anxiety and Stress) 
```{r}
# EFA
runModels(
  "Mplus/wave1/dass_student/dass1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/dass_student/dass1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_cfa.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave1/dass_student/dass1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_tx_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave1/dass_student/dass1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_gender_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave1/dass_student/dass1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass1_student_age_inv_scalar.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass2_student_age_inv_scalar.inp",
  recursive=TRUE)

# Longitudinal measurement invariance
runModels(
  "Mplus/wave1/dass_student/dass12_student_lg_inv_baseline.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass12_student_lg_inv_loading.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass12_student_lg_inv_threshold.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/dass_student/dass12_student_lg_inv_unique.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1",
               output_file = "Report_dass_student.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave1/dass_student/input_dass_student.xlsx"),
                 set_title = "Measurement Report - DASS Baseline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = FALSE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

```


### Locus of Control Time 1
```{r}
# EFA
runModels(
  "Mplus/wave1/loc_student/loc1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/loc_student/loc1_student_cfa.inp",
  recursive=TRUE)
```

## Tutors

### DASS
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/dass1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/constructs_tutor/dass1_tutor_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/dass1_tutor_cfa1.inp",
  recursive=TRUE)
```

### Empathy
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_efa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_efa1.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_cfa2.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/empathy1_tutor_cfa3.inp",
  recursive=TRUE)
```

### Auto (work-related efficacy)
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/auto1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/constructs_tutor/auto1_tutor_cfa.inp",
  recursive=TRUE)
```

### Bias (?)
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/bias1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/constructs_tutor/bias1_tutor_cfa.inp",
  recursive=TRUE)

# Categorical variable BIAS5_1 contains less than 2 categories.

runModels(
  "Mplus/wave1/constructs_tutor/bias1_tutor_cfa1.inp",
  recursive=TRUE)
```

### Hard Work
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/hardwork1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave1/constructs_tutor/hardwork1_tutor_cfa.inp",
  recursive=TRUE)
```

### Prosociality (?)
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/prosocial1_tutor_efa.inp",
  recursive=TRUE)

# CFA 

# theory-based one factor model (better fit)
runModels(
  "Mplus/wave1/constructs_tutor/prosocial1_tutor_cfa.inp",
  recursive=TRUE)

# three-factor model
runModels(
  "Mplus/wave1/constructs_tutor/prosocial1_tutor_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave1/constructs_tutor/prosocial1_tutor_cfa2.inp",
  recursive=TRUE)
```

### Perceptions
```{r}
# EFA
runModels(
  "Mplus/wave1/constructs_tutor/perceptions1_tutor_efa.inp",
  recursive=TRUE)

# CFA 
runModels(
  "Mplus/wave1/constructs_tutor/perceptions1_tutor_cfa.inp",
  recursive=TRUE)
```

```{r}
args <- list(
    output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1",  
    parameters = list(
    # set R code print options
    printcode = FALSE,
    printwarning = FALSE,
    storecache = FALSE,

    # set report overall parameters
    set_author = "Zezhen Wu",

    # select report sections
    item = TRUE,
    descriptive = TRUE,
    ds_plot = TRUE,
    correlation_matrix_lg = FALSE,
    correlation_matrix_bivar = FALSE,
    correlation_matrix_item = TRUE,
    efa_screeplot = TRUE,
    cfa_model_fit = TRUE,
    cfa_model_plot = TRUE,
    cfa_model_parameters = TRUE,
    cfa_model_thresholds = FALSE,
    cfa_r2 = FALSE,
    internal_reliability = TRUE,
    summary_item_statistics = FALSE,
    item_total_statistics = TRUE,
    inv_tx = FALSE,
    inv_gender = FALSE,
    inv_age = FALSE,
    inv_lg = FALSE
  )
)
```

```{r}
args$output_file = "Report_dass_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_dass_tutor.xlsx")
args$parameters$set_title = "Measurement Report - DASS Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_empathy_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_empathy_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Empathy Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_auto_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_auto_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Work-related Efficacy Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_bias_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_bias_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Bias Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_hardwork_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_hardwork_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Hard Work Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_prosociality_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_prosociality_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Prosociality Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_perceptions_tutor.docx"
args$parameters$template = here::here("Mplus/wave1/constructs_tutor/input_perceptions_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Perceptions Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
get.omega.bywave(model = "dass1_tutor_cfa1.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "empathy1_tutor_cfa1.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "auto1_tutor_cfa.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "bias1_tutor_cfa.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "hardwork1_tutor_cfa.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "perceptions1_tutor_cfa.out",
                 path = "Mplus/wave1/constructs_tutor")

get.omega.bywave(model = "prosocial1_tutor_cfa2.out",
                 path = "Mplus/wave1/constructs_tutor")
```



# WAVE 2

## Parents 

### DASS (Stress) Time 1

```{r}
prop.table(table(dat_dass_1$female))
prop.table(table(dat_dass_1$age_w))

summary(dat_dass_1$age_w)
sd(dat_dass_1$age_w)

dat_dass_1$dass_sum <- rowSums(dat_dass_1 |> select(dass1_1:dass7_1))

summary(dat_dass_1$dass_sum)
sd(dat_dass_1$dass_sum)

t.test(dat_dass_1$dass_sum, mu = 4.73)
```

```{r}
# EFA
runModels(
  "Mplus/wave2/dass_parent/dass1_parent_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/dass_parent/dass1_parent_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_cfa1.inp",
  recursive=TRUE) # final model

# Treatment measurement invariance
runModels(
  "Mplus/wave2/dass_parent/dass1_parent_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/dass_parent/dass1_parent_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/dass_parent/dass1_parent_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_parent/dass1_parent_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave1")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_dass_parent.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/dass_parent/input_dass_parent.xlsx"),
                 set_title = "Measurement Report - DASS Baseline (Parent)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = FALSE)
                 )

get.omega.bywave(model = "dass2_parent_cfa.out",
                 path = here::here("Mplus/wave2/dass_parent"))
```


## Students
### Grit Time 1

```{r}
nrow(dat_stu_b)
table(dat_stu_b$treatment)
summary(dat_stu_b$age_w)
sd(dat_stu_b$age_w)

prop.table(table(dat_stu_b$girl))
```

```{r}
# EFA
runModels(
  "Mplus/wave2/grit_student_1/grit1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/grit_student_1/grit1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_cfa2.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave2/grit_student_1/grit1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/grit_student_1/grit1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/grit_student_1/grit1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_1/grit1_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_grit_student_baseline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/grit_student_1/input_grit_student_1.xlsx"),
                 set_title = "Measurement Report - Grit (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

get.omega.bywave(model = "grit1_student_cfa2.out",
                 path = here::here("Mplus/wave2/grit_student_1"))

```

### Sleep Time 1
```{r}
# EFA
runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_cfa1.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/sleep_student_1/sleep1_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_sleep_student_baseline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/sleep_student_1/input_sleep_student_1.xlsx"),
                 set_title = "Measurement Report - Insomnia Severity Index - Baseline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = FALSE)
                 )


get.omega.bywave(model = "sleep1_student_cfa1.out",
                 path = here::here("Mplus/wave2/sleep_student_1"))
```

### DASS (Anxiety and Stress) Time 1 
```{r}
# EFA
runModels(
  "Mplus/wave2/dass_student_1/dass1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/dass_student_1/dass1_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_cfa1.inp",
  recursive=TRUE) # final

# Treatment measurement invariance
runModels(
  "Mplus/wave2/dass_student_1/dass1_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/dass_student_1/dass1_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/dass_student_1/dass1_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_1/dass1_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_dass_student_baseline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/dass_student_1/input_dass_student_1.xlsx"),
                 set_title = "Measurement Report - DASS Baseline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = FALSE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

get.omega.bywave(model = "dass1_student_cfa1.out",
                 path = here::here("Mplus/wave2/dass_student_1"))
```

### Locus of Control Time 1
```{r}
# EFA
runModels(
  "Mplus/wave2/loc_student_1/loc1_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/loc_student_1/loc1_student_cfa.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Volumes/GoogleDrive/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_loc_student_baseline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/loc_student_1/input_loc_student_1.xlsx"),
                 set_title = "Measurement Report - Locus of Control Baseline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = FALSE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = FALSE,
                 inv_gender = FALSE,
                 inv_age = FALSE,
                 inv_lg = FALSE)
                 )

get.omega.bywave(model = "loc1_student_cfa.out",
                 path = here::here("Mplus/wave2/loc_student_1"))
```

### Locus of Control Time 2
```{r}
# EFA
runModels(
  "Mplus/wave2/loc_student_2/loc2_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/loc_student_2/loc2_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/loc_student_2/loc2_student_cfa1.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Volumes/GoogleDrive/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_loc_student_endline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/loc_student_2/input_loc_student_2.xlsx"),
                 set_title = "Measurement Report - Locus of Control Endline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = FALSE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = FALSE,
                 inv_gender = FALSE,
                 inv_age = FALSE,
                 inv_lg = FALSE)
                 )

get.omega.bywave(model = "loc2_student_cfa.out",
                 path = here::here("Mplus/wave2/loc_student_2"))
```

### Grit Old Time 2

```{r}
nrow(dat_stu_e)
table(dat_stu_e$treatment)
summary(dat_stu_e$age_w)
sd(dat_stu_e$age_w)

prop.table(table(dat_stu_e$girl))
```

```{r}
# EFA
runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_cfa.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_old_student_2/grito2_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_grit_old_student_endline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/grit_old_student_2/input_grit_old_student_2.xlsx"),
                 set_title = "Measurement Report - Grit (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

get.omega.bywave(model = "grito2_student_cfa.out",
                 path = here::here("Mplus/wave2/grit_old_student_2"))

```


### Grit Time 2

```{r}
# EFA
runModels(
  "Mplus/wave2/grit_student_2/grit2_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/grit_student_2/grit2_student_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_cfa2.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave2/grit_student_2/grit2_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/grit_student_2/grit2_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/grit_student_2/grit2_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/grit_student_2/grit2_student_age_inv_scalar.inp",
  recursive=TRUE)

get.omega.bywave(model = "grit2_student_cfa1.out",
                 path = here::here("Mplus/wave2/grit_student_2"))
```

```{r}
# render_report_manual(output_file = "Report_dass_parent.docx",
#                      output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2")

render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_grit_student_endline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/grit_student_2/input_grit_student_2.xlsx"),
                 set_title = "Measurement Report - Grit (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = TRUE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

get.omega.bywave(model = "grit1_student_cfa2.out",
                 path = here::here("Mplus/wave2/grit_student_1"))

```

### DASS (Anxiety, Stress, Depression) Time 2 
```{r}
# EFA
runModels(
  "Mplus/wave2/dass_student_2/dass2_student_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/dass_student_2/dass2_student_cfa.inp",
  recursive=TRUE)

# Treatment measurement invariance
runModels(
  "Mplus/wave2/dass_student_2/dass2_student_tx_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_tx_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_tx_inv_scalar.inp",
  recursive=TRUE)

# Gender measurement invariance
runModels(
  "Mplus/wave2/dass_student_2/dass2_student_gender_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_gender_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_gender_inv_scalar.inp",
  recursive=TRUE)

# Age measurement invariance
runModels(
  "Mplus/wave2/dass_student_2/dass2_student_age_inv_config.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_age_inv_metric.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/dass_student_2/dass2_student_age_inv_scalar.inp",
  recursive=TRUE)
```

```{r}
render_report(output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2/auto-generated",
               output_file = "Report_dass_student_endline.docx",
               parameters = list(
                 # set R code print options
                 printcode = FALSE,
                 printwarning = FALSE,
                 storecache = FALSE,

                 # set report overall parameters
                 template = here::here("Mplus/wave2/dass_student_2/input_dass_student_2.xlsx"),
                 set_title = "Measurement Report - DASS Endline (Student)",
                 set_author = "Zezhen Wu",

                 # select report sections
                 item = TRUE,
                 descriptive = TRUE,
                 ds_plot = TRUE,
                 correlation_matrix_lg = FALSE,
                 correlation_matrix_bivar = FALSE,
                 correlation_matrix_item = TRUE, # BE CAREFUL! This might crash the document.
                 efa_screeplot = TRUE,
                 cfa_model_fit = TRUE,
                 cfa_model_plot = TRUE,
                 cfa_model_parameters = TRUE,
                 cfa_model_thresholds = FALSE, # default is to mute the thresholds as the table can get very long
                 cfa_r2 = FALSE,
                 internal_reliability = TRUE,
                 summary_item_statistics = TRUE,
                 item_total_statistics = TRUE,
                 inv_tx = TRUE,
                 inv_gender = TRUE,
                 inv_age = TRUE,
                 inv_lg = TRUE)
                 )

get.omega.bywave(model = "dass2_student_cfa.out",
                 path = here::here("Mplus/wave2/dass_student_2"))
```

## Tutors

### DASS
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/dass1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/constructs_tutor/dass1_tutor_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/dass1_tutor_cfa1.inp",
  recursive=TRUE)
```

### Empathy
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_efa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_efa1.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_cfa.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_cfa2.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/empathy1_tutor_cfa3.inp",
  recursive=TRUE)
```

### Auto (work-related efficacy)
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/auto1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/constructs_tutor/auto1_tutor_cfa.inp",
  recursive=TRUE)
```

### Bias (?)
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/bias1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/constructs_tutor/bias1_tutor_cfa.inp",
  recursive=TRUE)

# Categorical variable BIAS5_1 contains less than 2 categories.

runModels(
  "Mplus/wave2/constructs_tutor/bias1_tutor_cfa1.inp",
  recursive=TRUE)
```

### Hard Work
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/hardwork1_tutor_efa.inp",
  recursive=TRUE)

# CFA
runModels(
  "Mplus/wave2/constructs_tutor/hardwork1_tutor_cfa.inp",
  recursive=TRUE)
```

### Prosociality (?)
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/prosocial1_tutor_efa.inp",
  recursive=TRUE)

# CFA 

# theory-based one factor model (better fit)
runModels(
  "Mplus/wave2/constructs_tutor/prosocial1_tutor_cfa.inp",
  recursive=TRUE)

# three-factor model
runModels(
  "Mplus/wave2/constructs_tutor/prosocial1_tutor_cfa1.inp",
  recursive=TRUE)

runModels(
  "Mplus/wave2/constructs_tutor/prosocial1_tutor_cfa2.inp",
  recursive=TRUE)
```

### Perceptions
```{r}
# EFA
runModels(
  "Mplus/wave2/constructs_tutor/perceptions1_tutor_efa.inp",
  recursive=TRUE)

# CFA 
runModels(
  "Mplus/wave2/constructs_tutor/perceptions1_tutor_cfa.inp",
  recursive=TRUE)
```

```{r}
args <- list(
    output_dir = "/Users/michaelfive/Library/CloudStorage/GoogleDrive-wuzezhen33@gmail.com/My Drive/WB Ukraine Study/Reports/wave2",  
    parameters = list(
    # set R code print options
    printcode = FALSE,
    printwarning = FALSE,
    storecache = FALSE,

    # set report overall parameters
    set_author = "Zezhen Wu",

    # select report sections
    item = TRUE,
    descriptive = TRUE,
    ds_plot = TRUE,
    correlation_matrix_lg = FALSE,
    correlation_matrix_bivar = FALSE,
    correlation_matrix_item = TRUE,
    efa_screeplot = TRUE,
    cfa_model_fit = TRUE,
    cfa_model_plot = TRUE,
    cfa_model_parameters = TRUE,
    cfa_model_thresholds = FALSE,
    cfa_r2 = FALSE,
    internal_reliability = TRUE,
    summary_item_statistics = FALSE,
    item_total_statistics = TRUE,
    inv_tx = FALSE,
    inv_gender = FALSE,
    inv_age = FALSE,
    inv_lg = FALSE
  )
)
```

```{r}
args$output_file = "Report_dass_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_dass_tutor.xlsx")
args$parameters$set_title = "Measurement Report - DASS Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_empathy_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_empathy_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Empathy Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_auto_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_auto_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Work-related Efficacy Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_bias_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_bias_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Bias Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_hardwork_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_hardwork_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Hard Work Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_prosociality_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_prosociality_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Prosociality Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
args$output_file = "Report_perceptions_tutor.docx"
args$parameters$template = here::here("Mplus/wave2/constructs_tutor/input_perceptions_tutor.xlsx")
args$parameters$set_title = "Measurement Report - Perceptions Baseline (Tutors)"

do.call(render_report, args)
```

```{r}
get.omega.bywave(model = "dass1_tutor_cfa1.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "empathy1_tutor_cfa1.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "auto1_tutor_cfa.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "bias1_tutor_cfa1.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "hardwork1_tutor_cfa.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "perceptions1_tutor_cfa.out",
                 path = "Mplus/wave2/constructs_tutor")

get.omega.bywave(model = "prosocial1_tutor_cfa2.out",
                 path = "Mplus/wave2/constructs_tutor")
```


